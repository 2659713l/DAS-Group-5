---
title: "Group_5_Analysis"
number-sections: true
format: 
  html:
    embed-resources: true
    code-tools: true
  pdf: default
editor_options: 
  chunk_output_type: console
---

```{r}
#| echo: false
#| warning: false
#| message: false

library(dplyr)
library(ggplot2)
library(tidyverse)
library(gt)
library(MASS)
library(patchwork)
library(gapminder)
library(janitor)
library(tidymodels)
library(moderndive)
library(ggstats)
```

# Introduction {#sec-intro}

Obesity levels across Scotland are monitored with the Scottish Health Surveys. This includes socio-economic and lifestyle factors and their effect on the prevalence of obesity in Scotland. Looking specifically at data between 2013 and 2016, in this report we will be looking at whether or not the prevalence of obesity has changed over this time period. Also looking at whether there are differences in obesity prevalence caused by age, sex and socio-economic status.

```{r}
#| echo: false

# Read in the data
Project11 <- read.csv("DAProject11.csv")

# Add a new column called IsObese based on the value of BMI group
Project11 <- Project11 |>
  dplyr::mutate(IsObese = ifelse(BMIgroup == "Obese", "Obesity", "Not Obesity"))


Project11$Year <- as.factor(Project11$Year)
```

# Exploratory Analysis {#sec-exp}

```{r}
#| echo: false
#| label: tbl-proportion
#| tbl-cap: "Proportion of obseity by year"

Project11 |>
  tabyl(Year,IsObese) |>
  adorn_percentages() |>
  adorn_pct_formatting() |>
  adorn_ns() |>
  gt()
```

```{r}
#| echo: false
#| label: fig-barplot
#| message: false
#| fig-cap: "Barplot of year by Obesity"
#| fig-width: 4
#| fig-height: 3
#| fig-align: center

ggplot(data = Project11, aes(x = IsObese, group = Year))+
  geom_bar(aes(y = after_stat(prop), fill = Year), stat = "count", position = "dodge") +
  labs(y = "Proportion", fill = "Year")
```

```{r}
#| echo: false
Project11$AgeGroup <- as.factor(Project11$AgeGroup)
ggplot(data = Project11, aes(x = IsObese, group = AgeGroup))+
  geom_bar(aes(y = after_stat(prop), fill = AgeGroup), stat = "count", position = "dodge") +
  labs(y = "Proportion", fill = "AgeGroup")
```


```{r}
#| echo: false
Project11$Employment <- as.factor(Project11$Employment)
ggplot(data = Project11, aes(x = IsObese, group = Employment))+
  geom_bar(aes(y = after_stat(prop), fill = Employment), stat = "count", position = "dodge") +
  labs(y = "Proportion", fill = "Employment")
```

```{r}
#| echo: false
Project11$Sex <- as.factor(Project11$Sex)
ggplot(data = Project11, aes(x = IsObese, group = Sex))+
  geom_bar(aes(y = after_stat(prop), fill = Sex), stat = "count", position = "dodge") +
  labs(y = "Proportion", fill = "Sex")
```


# Formal Analysis {#sec-formal}

We fit the logistic regression model,

```{r}
#| echo: false
#| tbl-cap: "Estimates of the intercept and slope from the fitted logistic regression model"
#| label: tbl-estimates

Project11 <- Project11 |>
  dplyr::mutate(IsObese = ifelse(BMIgroup == "Obese", 1, 0))

model <- glm(IsObese ~ Year, data = Project11,
                     family = binomial(link = "logit")) 
Coefs <- round(coef(model), 3)
tidy(model)[,c(1,2,3,5)] |>
  gt() |>
  fmt_number(decimals=4)

```

# Conclusion {#sec-con}
