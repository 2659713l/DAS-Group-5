---
title: "Group_5_Analysis"
format: html
editor: visual
number-sections: true
format: 
  html:
    embed-resources: true
    code-tools: true
  pdf: default
editor_options: 
  chunk_output_type: console
---

<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< HEAD
## 
=======
>>>>>>> Stashed changes

```{r}
#| echo: false
=======
```{r}
#| echo: false

# Install and load the required libraries
install.packages("dplyr")
library(dplyr)             
>>>>>>> Stashed changes

# Install and load the required libraries
install.packages("dplyr")
library(dplyr)             

# Read in the data
data <- read.csv("DAProject11.csv")

# Add a new column called IsObese based on the value of BMI group
data <- data %>%
  mutate(IsObese = case_when(
    BMIgroup == "Obese" ~ 1,   # Assign 1 to 'obese'
    TRUE ~ 0                    # Assign 0 to every other category
  ))
```

<<<<<<< Updated upstream
```{r}
#| echo: false
# Alternative to calculating a binary variable for obese
data <- read.csv("DAProject11.csv")

ObesityStatus <- factor(data$BMIgroup == "Obese", levels = c(FALSE, TRUE), labels = c("Not Obese", "Obese"))
ObesityStatus
levels(data$ObesityStatus)

data <- cbind(data, ObesityStatus)

```


<<<<<<< Updated upstream
=======
=======

>>>>>>> Stashed changes
=======

>>>>>>> Stashed changes
# Introduction {#sec-intro}


# Exploratory Analysis {#sec-exp}
```{r}
<<<<<<< Updated upstream
#| echo: false

attach(data.obese)
ggplot(data = data.obese, aes(x = ObesityStatus, y = Year, fill = ObesityStatus)) +
  geom_boxplot() +
  labs(x = "IsObese", y = "Age Group") +
  theme(legend.position = "none")
=======
# Select the columns of interest
data.year <- data |>
  select(ObesityStatus, Year)

# Table of proportions by year
data.year |>
  tabyl(ObesityStatus, Year) |>
  adorn_percentages() |>
  adorn_pct_formatting() |>
  adorn_ns() # To show original count

data.year |> 
  summary()

ggplot(data.year, aes(x = Year, group = ObesityStatus)) +
  geom_bar(aes(y = after_stat(prop), fill = ObesityStatus), stat = "count", 
           position = "dodge") +
  labs(y = "Proportion", fill = "ObesityStatus")
>>>>>>> Stashed changes
```


# Formal Analysis {#sec-formal}
```{r}
#| echo: false
<<<<<<< Updated upstream
model <- logistic_reg() |> 
  set_engine("glm")
model <- model |> 
  fit(ObesityStatus ~ Year, data = data.obese) |>
  extract_fit_engine()

summary(model)


mod.coef.logodds <- model |>
  summary() |>
  coef()

obese.logodds.lower <- (mod.coef.logodds["Year", "Estimate"] 
                      - 1.96 * mod.coef.logodds["Year", "Std. Error"])
obese.logodds.lower
obese.logodds.upper <- (mod.coef.logodds["Year", "Estimate"] 
                      + 1.96 * mod.coef.logodds["Year", "Std. Error"])
obese.logodds.upper

plot_model(model, show.values = TRUE, transform = NULL,
           title = "Log-Odds (Obese)", show.p = FALSE)

data.obese <- data.obese |>
  mutate(logodds.Obese = predict(model))
data.obese
```

```{r}
#| echo: false

# Odds
model |>
  coef() |>
  exp()

obese.odds.lower <- exp(age.logodds.lower)
obese.odds.lower
obese.odds.upper <- exp(age.logodds.upper)
obese.odds.upper

plot_model(model, show.values = TRUE,
           title = "Odds (Obese)", show.p = FALSE, axis.lim = c(1, 1.5))

data.obese <- data.obese |>
  mutate(odds.obese = exp(logodds.obese))
```

```{r}
#| echo: false

# Probabilities
# Predictions for 2016
plogis(mod.coef.logodds["(Intercept)", "Estimate"] 
       + mod.coef.logodds["Year", "Estimate"] * 2016)

data.obese <- data.obese |>
  mutate(probs.obese = fitted(model))

ggplot(data = data.obese, aes(x = Year, y = probs.obese)) +
  geom_smooth(method = "glm", method.args = list(family = "binomial"), se = FALSE) +
  labs(x = "Year", y = "Probability of being obese")

plot_model(model, type = "pred", title = "", terms="Year [all]", axis.title = c("Age", "Prob. of being obese"))

```

# Conclusion {#sec-con}
>>>>>>> main
=======
# Formal Analysis- Log-Odds ----------------------------------------------------

Year <- as.factor(data.year$Year)
levels(Year)

# The logistic model is given by
model.year <- logistic_reg() |> 
  set_engine("glm") |> 
  fit(ObesityStatus ~ Year, data = data.year) |>
  extract_fit_engine()

model.year |>
  summary()

mod.year.coef.logodds <- model.year |>
  summary() |>
  coef()

mod.year.coef.logodds

year.logodds.upper <- (mod.year.coef.logodds["Year", "Estimate"] 
                       + 1.96 *
                         mod.year.coef.logodds["Year", "Std. Error"])
year.logodds.upper


year.logodds.lower <- (mod.year.coef.logodds["Year", "Estimate"] 
                       - 1.96 *
                         mod.year.coef.logodds["Year", "Std. Error"])
year.logodds.lower

plot_model(model.year, show.values = TRUE, transform = NULL, 
           title = "Log-Odds (2013)", show.p = FALSE)

# Add the estimates if the log-odds to our data set
data.year <- data.year |>
  mutate(logodds.2013 = predict(model.year))

# Formal Analysis - Odds -------------------------------------------------------

# Take exponential of log-odds coefficients
model.year |>
  coef() |>
  exp()

# the number of not obese
pmin <- data.year |>
  filter(ObesityStatus == "Not Obese") |>
  summarize(n()) |>
  pull()

# the number of not obese people in 2013
pmin.notobese <- data.year |>
  filter(ObesityStatus == "Not Obese", Year == "2013") |>
  summarize(n()) |>
  pull()

# the proportion/probability of not obese people in 2013
prob.notobese.2013 <- pmin.notobese / pmin
odds.notobese.2013 <- prob.notobese.2013 / (1 - prob.notobese.2013)
odds.notobese.2013  

# the number of people who are obese
p.obese <- data.year |>
  filter(ObesityStatus == "Obese") |>
  summarize(n()) |>
  pull()

# the number of obese people in 2013
p.obese.2013 <- data.year |>
  filter(ObesityStatus == "Obese", Year == "2013") |>
  summarize(n()) |>
  pull()

# the proportion/probability of being obese in 2013
prob.obese.2013 <- p.obese.2013 / p.obese
odds.obese.2013 <- prob.obese.2013 / (1 - prob.obese.2013)
odds.ratio.obese <- odds.obese.2013 / odds.obese.2013

# 95% confidence interval

year.odds.lower <- exp(year.logodds.lower)

year.odds.upper <- exp(year.logodds.upper)

# Graph this confidence interval
plot_model(model.year, show.values = TRUE,
           title = "Odds (Being not obese)", show.p = FALSE)

# Add the estimates to the data set
data.year <- data.year |>
  mutate(odds.2013 = exp(logodds.2013))

# Formal analysis - Probabilities -----------------------------------------------

plogis(mod.year.coef.logodds["(Intercept)", "Estimate"])

plogis(mod.year.coef.logodds["(Intercept)", "Estimate"] +
         mod.year.coef.logodds["Year", "Estimate"])

data.year <- data.year |>
  mutate(probs.2013 = fitted(model.year))

plot_model(model.year, type = "pred", terms = "ObesityStatus" )


```


# Conclusion {#sec-con}

>>>>>>> Stashed changes
